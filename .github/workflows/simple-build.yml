name: Build Simple HoMM3 AI Executable

on:
  push:
    tags:
      - 'v*'
  workflow_dispatch:

permissions:
  contents: write

jobs:
  build-windows:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          
      - name: Build Windows executables
        run: |
          pip install pyinstaller
          pyinstaller --onefile --windowed --name "HoMM3-AI-Opponent" --add-data "VERSION.txt;." homm3_ai_ultra_simple.py
          pyinstaller --onefile --windowed --name "HoMM3-AI-Game" --add-data "VERSION.txt;." homm3_game_simulator.py
          
      - name: Verify executable exists
        run: |
          dir dist
          echo "Executable built successfully"
          
      - name: Upload Windows executables
        uses: actions/upload-artifact@v4
        with:
          name: HoMM3-AI-Windows
          path: |
            dist/HoMM3-AI-Opponent.exe
            dist/HoMM3-AI-Game.exe

  create-release:
    needs: [build-windows]
    runs-on: ubuntu-latest
    if: startsWith(github.ref, 'refs/tags/')
    steps:
      - uses: actions/checkout@v4
      
      - name: Download artifacts
        uses: actions/download-artifact@v4
        
      - name: Create release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            HoMM3-AI-Windows/HoMM3-AI-Opponent.exe
            HoMM3-AI-Windows/HoMM3-AI-Game.exe
          body: |
            ## Heroes III AI Opponent v${{ github.ref_name }}
            
            **Two versions available - download and double-click to run!**
            
            ### HoMM3-AI-Opponent.exe
            - File monitor for VCMI integration
            - Advanced users can configure VCMI to communicate with this
            
            ### HoMM3-AI-Game.exe
            - Complete standalone Heroes III-style game
            - Play immediately against intelligent AI
            - Turn-based strategy with armies, resources, and combat
            
            ### How to use HoMM3-AI-Game.exe:
            1. Download and run HoMM3-AI-Game.exe
            2. Use buttons to recruit units, capture locations
            3. Click "End Turn" to let AI play
            4. Battle until one side wins!
            
            No installation or setup required for either version!
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
